import{j as e,S as Ce}from"./ui-DrjZcVPk.js";import{u as Se,b as r}from"./vendor-DWqeVyvT.js";import{c as G,e as f,u as we,P as re,B as o,C as b,i as C,j as S,a as w,y as i,I as u,X as _,S as _e,t as d,p as W}from"./index-CPXgTZqr.js";import{C as ke}from"./CarSelector-BcGJhTKV.js";import{F as le,T as Pe,P as ie,C as Fe}from"./checkbox-ZGZd9czF.js";import{S as ne,a as ce,b as oe,c as de,d as me}from"./select-DJNuIx2U.js";import{B as Te}from"./badge-BBs-Ut3W.js";import{C as Ie}from"./chevron-right-UKWQEE6s.js";import{C as Le}from"./useCarCatalog-BsXcR9y7.js";import{P as Ae}from"./printer-BJ2LNHpe.js";import"./supabase-DiJShdzZ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ee=G("arrow-left",De);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],$e=G("image",Be);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ue=G("upload",Ue);function Ve({...t}){return e.jsx("nav",{"aria-label":"breadcrumb","data-slot":"breadcrumb",...t})}function qe({className:t,...n}){return e.jsx("ol",{"data-slot":"breadcrumb-list",className:f("text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",t),...n})}function Y({className:t,...n}){return e.jsx("li",{"data-slot":"breadcrumb-item",className:f("inline-flex items-center gap-1.5",t),...n})}function xe({asChild:t,className:n,...h}){const x=t?Ce:"a";return e.jsx(x,{"data-slot":"breadcrumb-link",className:f("hover:text-foreground transition-colors",n),...h})}function ze({className:t,...n}){return e.jsx("span",{"data-slot":"breadcrumb-page",role:"link","aria-disabled":"true","aria-current":"page",className:f("text-foreground font-normal",t),...n})}function he({children:t,className:n,...h}){return e.jsx("li",{"data-slot":"breadcrumb-separator",role:"presentation","aria-hidden":"true",className:f("[&>svg]:size-3.5",n),...h,children:t??e.jsx(Ie,{})})}const Me=["Exterior","Interior","Engine","Suspension","Wheels & Tires","Lighting","Electronics","Tools & Accessories","Performance","Aesthetic"],Re=["Easy","Medium","Hard","Professional"];function as(){const{user:t,profile:n}=we(),h=Se(),[x,K]=r.useState(!1),[k,X]=r.useState(""),[J,Q]=r.useState(""),[P,Z]=r.useState(""),[F,ee]=r.useState(""),[g,T]=r.useState([]),[y,I]=r.useState(""),[L,A]=r.useState(null),[se,D]=r.useState(null),[p,E]=r.useState(null),[m,B]=r.useState([]),[l,$]=r.useState(null),[U,V]=r.useState(!1),[q,z]=r.useState({installation_difficulty:"Medium",materials:[],tools_required:[],performance_gains:[]}),[v,N]=r.useState({layer_height:.2,infill_percentage:20,supports:!1,material_recommendation:["PLA"]}),pe=s=>{const a=s.target.files?.[0];if(a){A(a);const c=new FileReader;c.onload=M=>{D(M.target?.result)},c.readAsDataURL(a)}},ge=s=>{const a=s.target.files?.[0];a&&a.name.toLowerCase().endsWith(".stl")?E(a):d.error("Please select a valid STL file")},ae=()=>{y.trim()&&!g.includes(y.trim())&&(T([...g,y.trim()]),I(""))},je=s=>{T(g.filter(a=>a!==s))},fe=s=>{$(s);const a=s&&s.make&&s.model&&s.year;V(!!a)},ye=()=>{if(U&&l?.make&&l?.model&&l?.year){const s={make:l.make,model:l.model,year:l.year,trim:l.trim||void 0,engine:l.engine||void 0};m.some(c=>c.make===s.make&&c.model===s.model&&c.year===s.year&&c.trim===s.trim)||(B([...m,s]),$(null),V(!1))}},ve=s=>{B(m.filter((a,c)=>c!==s))},Ne=()=>{X(""),Q(""),Z(""),ee(""),T([]),I(""),A(null),D(null),E(null),B([]),$(null),V(!1),z({installation_difficulty:"Medium",materials:[],tools_required:[],performance_gains:[]}),N({layer_height:.2,infill_percentage:20,supports:!1,material_recommendation:["PLA"]})},be=async s=>{if(s.preventDefault(),!t||!n?.is_creator){d.error("You must be a registered creator to create products");return}if(!k.trim()||!P||!F){d.error("Please fill in all required fields");return}if(m.length===0){d.error("Please add at least one vehicle fitment");return}K(!0);try{let a="",c="";if(L){const H=`products/${t.id}/${Date.now()}_${L.name}`,{data:O,error:j}=await W.uploadFile(L,"product-images",H);j?(console.error("Image upload error:",j),d.error("Failed to upload image. Storage may not be configured yet.")):a=O?.url||""}if(p){const H=`stl-files/${t.id}/${Date.now()}_${p.name}`,{data:O,error:j}=await W.uploadFile(p,"stl-files",H);j?(console.error("STL upload error:",j),d.error("Failed to upload STL file. Storage may not be configured yet.")):c=O?.url||""}const M={title:k.trim(),description:J.trim()||void 0,price:parseFloat(P),category:F,image_url:a||void 0,stl_file_url:c||void 0,fitment:m,specifications:q,print_settings:v,is_published:!0,tags:g},{data:He,error:R}=await W.createProduct(M);R?(console.error("Create product error:",R),d.error(`Failed to create product: ${R.message||"Unknown error"}`)):(d.success("Product created successfully!"),Ne(),h("/my-account"))}catch(a){d.error("An unexpected error occurred"),console.error("Product creation error:",a)}finally{K(!1)}},te=()=>{x||h("/my-account")};return n?.is_creator?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsx(Ve,{children:e.jsxs(qe,{children:[e.jsx(Y,{children:e.jsx(xe,{href:"/",children:"Home"})}),e.jsx(he,{}),e.jsx(Y,{children:e.jsx(xe,{href:"/my-account",children:"My Account"})}),e.jsx(he,{}),e.jsx(Y,{children:e.jsx(ze,{children:"Create Product"})})]})})}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs(o,{variant:"ghost",size:"sm",onClick:te,disabled:x,className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(re,{className:"h-8 w-8"}),"Create New Product"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Add a new 3D printable car part to your store"})]})]}),e.jsxs("form",{onSubmit:be,className:"space-y-8",children:[e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Basic Information"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Product Title *"}),e.jsx(u,{id:"title",value:k,onChange:s=>X(s.target.value),placeholder:"e.g., BMW E90 Front Splitter V2",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"price",children:"Price (USD) *"}),e.jsx(u,{id:"price",type:"number",step:"0.01",min:"0",value:P,onChange:s=>Z(s.target.value),placeholder:"24.99",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"category",children:"Category *"}),e.jsxs(ne,{value:F,onValueChange:ee,required:!0,children:[e.jsx(ce,{children:e.jsx(oe,{placeholder:"Select a category"})}),e.jsx(de,{children:Me.map(s=>e.jsx(me,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",children:"Description"}),e.jsx(Pe,{id:"description",value:J,onChange:s=>Q(s.target.value),placeholder:"Describe your product, its features, and benefits...",rows:4})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{children:"Tags (Optional)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:g.map((s,a)=>e.jsxs(Te,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(_,{className:"h-3 w-3 cursor-pointer",onClick:()=>je(s)})]},a))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{value:y,onChange:s=>I(s.target.value),placeholder:"Add a tag...",onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),ae())}),e.jsx(o,{type:"button",variant:"outline",onClick:ae,children:e.jsx(ie,{className:"h-4 w-4"})})]})]})]})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),"File Uploads"]})}),e.jsx(w,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Product Image"}),se?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:se,alt:"Preview",className:"w-full h-48 object-cover rounded-md"}),e.jsx(o,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{A(null),D(null)},children:e.jsx(_,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-md p-8 text-center hover:border-primary/50 transition-colors",children:[e.jsx(ue,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload product image"})]}),e.jsx(u,{type:"file",accept:"image/*",onChange:pe,className:"cursor-pointer"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"STL File"}),p?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:p.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(p.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>E(null),children:e.jsx(_,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-md p-8 text-center hover:border-primary/50 transition-colors",children:[e.jsx(ue,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload STL file"})]}),e.jsx(u,{type:"file",accept:".stl",onChange:ge,className:"cursor-pointer"})]})]})})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Vehicle Compatibility *"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Select Vehicle:"}),e.jsx(ke,{onSelectionChange:fe})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(o,{type:"button",onClick:ye,disabled:!U,className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Add Vehicle"]}),U&&l&&e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground px-3 py-2 bg-muted rounded-md",children:[e.jsx("strong",{children:"Selected:"}),"Â ",l.year," ",l.make," ",l.model,l.trim&&` ${l.trim}`]})]}),m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Compatible Vehicles (",m.length,"):"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:m.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm",children:[s.year," ",s.make," ",s.model,s.trim&&` ${s.trim}`,s.engine&&` (${s.engine})`]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>ve(a),children:e.jsx(_,{className:"h-4 w-4"})})]},a))})]})]})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Optional Settings"]})}),e.jsx(w,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Installation"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Difficulty Level"}),e.jsxs(ne,{value:q.installation_difficulty,onValueChange:s=>z(a=>({...a,installation_difficulty:s})),children:[e.jsx(ce,{children:e.jsx(oe,{})}),e.jsx(de,{children:Re.map(s=>e.jsx(me,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Installation Time"}),e.jsx(u,{value:q.installation_time||"",onChange:s=>z(a=>({...a,installation_time:s.target.value})),placeholder:"e.g., 30-45 minutes"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Print Settings"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Layer Height (mm)"}),e.jsx(u,{type:"number",step:"0.01",value:v.layer_height||"",onChange:s=>N(a=>({...a,layer_height:parseFloat(s.target.value)||void 0})),placeholder:"0.2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Infill (%)"}),e.jsx(u,{type:"number",value:v.infill_percentage||"",onChange:s=>N(a=>({...a,infill_percentage:parseInt(s.target.value)||void 0})),placeholder:"20"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{id:"supports",checked:v.supports||!1,onCheckedChange:s=>N(a=>({...a,supports:!!s}))}),e.jsx(i,{htmlFor:"supports",children:"Supports Required"})]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx(o,{type:"button",variant:"outline",onClick:te,disabled:x,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:x,size:"lg",children:x?"Creating...":"Create Product"})]})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Creator Account Required"}),e.jsx("p",{className:"text-sm mb-4",children:"You need creator approval to sell products"}),e.jsx(o,{variant:"outline",disabled:!0,children:"Contact Admin for Approval"})]})})}export{as as CreateProductPage};
